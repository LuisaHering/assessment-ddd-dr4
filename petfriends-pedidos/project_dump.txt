=== File: .idea/compiler.xml ===
<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CompilerConfiguration">
    <annotationProcessing>
      <profile name="Maven default annotation processors profile" enabled="true">
        <sourceOutputDir name="target/generated-sources/annotations" />
        <sourceTestOutputDir name="target/generated-test-sources/test-annotations" />
        <outputRelativeToContentRoot value="true" />
        <module name="TP3_DR4_Luisa" />
      </profile>
    </annotationProcessing>
  </component>
  <component name="JavacSettings">
    <option name="ADDITIONAL_OPTIONS_OVERRIDE">
      <module name="TP3_DR4_Luisa" options="-parameters" />
    </option>
  </component>
</project>

=== File: .idea/encodings.xml ===
<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="Encoding">
    <file url="file://$PROJECT_DIR$/src/main/java" charset="UTF-8" />
  </component>
</project>

=== File: .idea/jarRepositories.xml ===
<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="RemoteRepositoriesConfiguration">
    <remote-repository>
      <option name="id" value="central" />
      <option name="name" value="Central Repository" />
      <option name="url" value="https://repo.maven.apache.org/maven2" />
    </remote-repository>
    <remote-repository>
      <option name="id" value="central" />
      <option name="name" value="Maven Central repository" />
      <option name="url" value="https://repo1.maven.org/maven2" />
    </remote-repository>
    <remote-repository>
      <option name="id" value="jboss.community" />
      <option name="name" value="JBoss Community repository" />
      <option name="url" value="https://repository.jboss.org/nexus/content/repositories/public/" />
    </remote-repository>
  </component>
</project>

=== File: .idea/misc.xml ===
<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="ExternalStorageConfigurationManager" enabled="true" />
  <component name="MavenProjectsManager">
    <option name="originalFiles">
      <list>
        <option value="$PROJECT_DIR$/pom.xml" />
      </list>
    </option>
  </component>
  <component name="ProjectRootManager" version="2" languageLevel="JDK_21" default="true" project-jdk-name="21" project-jdk-type="JavaSDK" />
</project>

=== File: .idea/workspace.xml ===
<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="AutoImportSettings">
    <option name="autoReloadType" value="SELECTIVE" />
  </component>
  <component name="ChangeListManager">
    <list default="true" id="375b244d-086e-4d4f-ad7e-505687fff5ee" name="Changes" comment="" />
    <option name="SHOW_DIALOG" value="false" />
    <option name="HIGHLIGHT_CONFLICTS" value="true" />
    <option name="HIGHLIGHT_NON_ACTIVE_CHANGELIST" value="false" />
    <option name="LAST_RESOLUTION" value="IGNORE" />
  </component>
  <component name="FileTemplateManagerImpl">
    <option name="RECENT_TEMPLATES">
      <list>
        <option value="Class" />
      </list>
    </option>
  </component>
  <component name="MavenImportPreferences">
    <option name="generalSettings">
      <MavenGeneralSettings>
        <option name="mavenHomeTypeForPersistence" value="WRAPPER" />
      </MavenGeneralSettings>
    </option>
  </component>
  <component name="ProblemsViewState">
    <option name="selectedTabId" value="DEPENDENCY_CHECKER_PROBLEMS_TAB" />
  </component>
  <component name="ProjectColorInfo">{
  &quot;associatedIndex&quot;: 1
}</component>
  <component name="ProjectId" id="35lzw9jwj0Eub9hnnovLqGsCc1x" />
  <component name="ProjectViewState">
    <option name="hideEmptyMiddlePackages" value="true" />
    <option name="showLibraryContents" value="true" />
  </component>
  <component name="PropertiesComponent"><![CDATA[{
  "keyToString": {
    "ModuleVcsDetector.initialDetectionPerformed": "true",
    "RequestMappingsPanelOrder0": "0",
    "RequestMappingsPanelOrder1": "1",
    "RequestMappingsPanelWidth0": "75",
    "RequestMappingsPanelWidth1": "75",
    "RunOnceActivity.ShowReadmeOnStart": "true",
    "RunOnceActivity.TerminalTabsStorage.copyFrom.TerminalArrangementManager": "true",
    "Spring Boot.Tp3Dr4LuisaApplication.executor": "Run",
    "last_opened_file_path": "C:/Users/Luisa/Downloads/TP3_DR4_Luisa/TP3_DR4_Luisa",
    "node.js.detected.package.eslint": "true",
    "node.js.detected.package.tslint": "true",
    "node.js.selected.package.eslint": "(autodetect)",
    "node.js.selected.package.tslint": "(autodetect)",
    "nodejs_package_manager_path": "npm",
    "vue.rearranger.settings.migration": "true"
  }
}]]></component>
  <component name="RunManager">
    <configuration name="Tp3Dr4LuisaApplication" type="SpringBootApplicationConfigurationType" factoryName="Spring Boot" nameIsGenerated="true">
      <module name="TP3_DR4_Luisa" />
      <option name="SPRING_BOOT_MAIN_CLASS" value="com.infnet.petfriends_pedidos.PetfriendsPedidosApplication" />
      <method v="2">
        <option name="Make" enabled="true" />
      </method>
    </configuration>
  </component>
  <component name="SharedIndexes">
    <attachedChunks>
      <set>
        <option value="bundled-jdk-9823dce3aa75-fbdcb00ec9e3-intellij.indexing.shared.core-IU-251.26927.53" />
        <option value="bundled-js-predefined-d6986cc7102b-09060db00ec0-JavaScript-IU-251.26927.53" />
      </set>
    </attachedChunks>
  </component>
  <component name="TaskManager">
    <task active="true" id="Default" summary="Default task">
      <changelist id="375b244d-086e-4d4f-ad7e-505687fff5ee" name="Changes" comment="" />
      <created>1763699681702</created>
      <option name="number" value="Default" />
      <option name="presentableId" value="Default" />
      <updated>1763699681702</updated>
      <workItem from="1763699682810" duration="286000" />
      <workItem from="1763699979030" duration="1313000" />
      <workItem from="1763879425125" duration="6279000" />
      <workItem from="1764002791244" duration="1728000" />
    </task>
    <servers />
  </component>
  <component name="TypeScriptGeneratedFilesManager">
    <option name="version" value="3" />
  </component>
</project>

=== File: .mvn/wrapper/maven-wrapper.properties ===
wrapperVersion=3.3.4
distributionType=only-script
distributionUrl=https://repo.maven.apache.org/maven2/org/apache/maven/apache-maven/3.9.11/apache-maven-3.9.11-bin.zip


=== File: HELP.md ===
# Getting Started

### Reference Documentation
For further reference, please consider the following sections:

* [Official Apache Maven documentation](https://maven.apache.org/guides/index.html)
* [Spring Boot Maven Plugin Reference Guide](https://docs.spring.io/spring-boot/3.5.8/maven-plugin)
* [Create an OCI image](https://docs.spring.io/spring-boot/3.5.8/maven-plugin/build-image.html)
* [Spring Web](https://docs.spring.io/spring-boot/3.5.8/reference/web/servlet.html)
* [Spring Data JPA](https://docs.spring.io/spring-boot/3.5.8/reference/data/sql.html#data.sql.jpa-and-spring-data)
* [Spring Boot Actuator](https://docs.spring.io/spring-boot/3.5.8/reference/actuator/index.html)
* [Validation](https://docs.spring.io/spring-boot/3.5.8/reference/io/validation.html)

### Guides
The following guides illustrate how to use some features concretely:

* [Building a RESTful Web Service](https://spring.io/guides/gs/rest-service/)
* [Serving Web Content with Spring MVC](https://spring.io/guides/gs/serving-web-content/)
* [Building REST services with Spring](https://spring.io/guides/tutorials/rest/)
* [Accessing Data with JPA](https://spring.io/guides/gs/accessing-data-jpa/)
* [Building a RESTful Web Service with Spring Boot Actuator](https://spring.io/guides/gs/actuator-service/)
* [Validation](https://spring.io/guides/gs/validating-form-input/)

### Maven Parent overrides

Due to Maven's design, elements are inherited from the parent POM to the project POM.
While most of the inheritance is fine, it also inherits unwanted elements like `<license>` and `<developers>` from the parent.
To prevent this, the project POM contains empty overrides for these elements.
If you manually switch to a different parent and actually want the inheritance, you need to remove those overrides.



=== File: pom.xml ===
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">
	<modelVersion>4.0.0</modelVersion>
	<parent>
		<groupId>org.springframework.boot</groupId>
		<artifactId>spring-boot-starter-parent</artifactId>
		<version>3.5.8</version>
		<relativePath/> <!-- lookup parent from repository -->
	</parent>
	<groupId>com.infnet</groupId>
	<artifactId>TP3_DR4_Luisa</artifactId>
	<version>0.0.1-SNAPSHOT</version>
	<name>TP3_DR4_Luisa</name>
	<description>Demo project for Spring Boot</description>
	<url/>
	<licenses>
		<license/>
	</licenses>
	<developers>
		<developer/>
	</developers>
	<scm>
		<connection/>
		<developerConnection/>
		<tag/>
		<url/>
	</scm>
	<properties>
		<java.version>21</java.version>
	</properties>
	<dependencies>
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-actuator</artifactId>
		</dependency>
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-data-jpa</artifactId>
		</dependency>
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-validation</artifactId>
		</dependency>
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-web</artifactId>
		</dependency>

		<dependency>
			<groupId>com.h2database</groupId>
			<artifactId>h2</artifactId>
			<scope>runtime</scope>
		</dependency>
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-test</artifactId>
			<scope>test</scope>
		</dependency>
		<dependency>
			<groupId>org.axonframework</groupId>
			<artifactId>axon-spring-boot-starter</artifactId>
			<version>4.10.0</version>
			<exclusions>
				<exclusion>
					<groupId>org.axonframework</groupId>
					<artifactId>axon-server-connector</artifactId>
				</exclusion>
			</exclusions>
		</dependency>
		<dependency>
			<groupId>org.springdoc</groupId>
			<artifactId>springdoc-openapi-starter-webmvc-ui</artifactId>
			<version>2.6.0</version>
		</dependency>
	</dependencies>

	<build>
		<plugins>
			<plugin>
				<groupId>org.springframework.boot</groupId>
				<artifactId>spring-boot-maven-plugin</artifactId>
			</plugin>
		</plugins>
	</build>

</project>


=== File: src/main/java/com/infnet/TP3_DR4_Luisa/commands/BaseCommand.java ===
package com.infnet.petfriends_pedidos.commands;

import org.axonframework.modelling.command.TargetAggregateIdentifier;

/**
 * Classe base para todos os comandos que serão processados
 * pelo Axon Framework e provocarão a persistência de eventos.
 * A anotação @TargetAggregateIdentifier indica qual agregado
 * será alvo do comando.
 */
public class BaseCommand<T> {

    @TargetAggregateIdentifier
    public final T id;

    public BaseCommand(T id) {
        this.id = id;
    }
}

=== File: src/main/java/com/infnet/TP3_DR4_Luisa/commands/CancelarPedidoCommand.java ===
package com.infnet.petfriends_pedidos.commands;

/**
 * Comando para cancelar pedido.
 * FECHADO ou EM_PREPARACAO -> CANCELADO
 */
public class CancelarPedidoCommand extends BaseCommand<String> {

    public final String motivo;

    public CancelarPedidoCommand(String id, String motivo) {
        super(id);
        this.motivo = motivo;
    }
}

=== File: src/main/java/com/infnet/TP3_DR4_Luisa/commands/CriarPedidoCommand.java ===
package com.infnet.petfriends_pedidos.commands;

import java.math.BigDecimal;

/**
 * Comando para criar um novo pedido.
 * Representa a INTENÇÃO de criar (verbo imperativo).
 * Será processado pelo CommandHandler no agregado.
 */
public class CriarPedidoCommand extends BaseCommand<String> {

    public final String clienteId;
    public final BigDecimal valorTotal;

    public CriarPedidoCommand(String id, String clienteId,
                              BigDecimal valorTotal) {
        super(id);
        this.clienteId = clienteId;
        this.valorTotal = valorTotal;
    }
}

=== File: src/main/java/com/infnet/TP3_DR4_Luisa/commands/EnviarPedidoCommand.java ===
package com.infnet.petfriends_pedidos.commands;

/**
 * Comando para enviar pedido ao almoxarifado.
 * FECHADO -> EM_PREPARACAO
 */
public class EnviarPedidoCommand extends BaseCommand<String> {

    public EnviarPedidoCommand(String id) {
        super(id);
    }
}

=== File: src/main/java/com/infnet/TP3_DR4_Luisa/commands/FecharPedidoCommand.java ===
package com.infnet.petfriends_pedidos.commands;

/**
 * Comando para fechar pedido após pagamento confirmado.
 * NOVO -> FECHADO
 */
public class FecharPedidoCommand extends BaseCommand<String> {

    public FecharPedidoCommand(String id) {
        super(id);
    }
}

=== File: src/main/java/com/infnet/TP3_DR4_Luisa/controllers/PedidoCommandController.java ===
package com.infnet.petfriends_pedidos.controllers;

import com.infnet.petfriends_pedidos.domain.Pedido;
import com.infnet.petfriends_pedidos.services.PedidoCommandService;
import io.swagger.v3.oas.annotations.Operation;
import io.swagger.v3.oas.annotations.tags.Tag;
import org.springframework.web.bind.annotation.*;

import java.util.Map;
import java.util.concurrent.CompletableFuture;

@RestController
@RequestMapping(value = "/pedidos")
@Tag(name = "Pedidos - Comandos", description = "Operações de escrita (Commands)")
public class PedidoCommandController {

    private final PedidoCommandService service;

    public PedidoCommandController(PedidoCommandService service) {
        this.service = service;
    }

    @PostMapping
    @Operation(summary = "Criar novo pedido")
    public CompletableFuture<String> criarPedido(@RequestBody Pedido pedido) {
        return service.criarPedido(pedido);
    }

    @PutMapping("/{id}/fechar")
    @Operation(summary = "Fechar pedido (confirmar pagamento)")
    public CompletableFuture<Void> fecharPedido(@PathVariable String id) {
        return service.fecharPedido(id);
    }

    @PutMapping("/{id}/enviar")
    @Operation(summary = "Enviar pedido para preparação")
    public CompletableFuture<Void> enviarPedido(@PathVariable String id) {
        return service.enviarPedido(id);
    }

    @PutMapping("/{id}/cancelar")
    @Operation(summary = "Cancelar pedido")
    public CompletableFuture<Void> cancelarPedido(
            @PathVariable String id,
            @RequestBody Map<String, String> body) {
        String motivo = body.getOrDefault("motivo", "Não informado");
        return service.cancelarPedido(id, motivo);
    }
}

=== File: src/main/java/com/infnet/TP3_DR4_Luisa/controllers/PedidoQueryController.java ===
package com.infnet.petfriends_pedidos.controllers;

import com.infnet.petfriends_pedidos.domain.Pedido;
import com.infnet.petfriends_pedidos.services.PedidoQueryService;
import io.swagger.v3.oas.annotations.Operation;
import io.swagger.v3.oas.annotations.tags.Tag;
import org.springframework.web.bind.annotation.*;

import java.util.List;

@RestController
@RequestMapping(value = "/pedidos")
@Tag(name = "Pedidos - Queries", description = "Operações de leitura (Queries)")
public class PedidoQueryController {

    private final PedidoQueryService service;

    public PedidoQueryController(PedidoQueryService service) {
        this.service = service;
    }

    @GetMapping("/{id}/eventos")
    @Operation(summary = "Listar eventos do pedido")
    public List<Object> listarEventos(@PathVariable(value = "id") String id) {
        return service.listarEventos(id);
    }

    @GetMapping("/{id}")
    @Operation(summary = "Obter pedido por ID")
    public Pedido obterPorId(@PathVariable(value = "id") String id) {
        return service.obterPorId(id).orElse(null);
    }
}

=== File: src/main/java/com/infnet/TP3_DR4_Luisa/domain/Pedido.java ===
package com.infnet.petfriends_pedidos.domain;

import com.infnet.petfriends_pedidos.commands.*;
import com.infnet.petfriends_pedidos.events.*;
import jakarta.persistence.Entity;
import jakarta.persistence.Id;
import org.axonframework.commandhandling.CommandHandler;
import org.axonframework.eventsourcing.EventSourcingHandler;
import org.axonframework.modelling.command.AggregateIdentifier;
import org.axonframework.modelling.command.AggregateLifecycle;
import org.axonframework.spring.stereotype.Aggregate;

import java.math.BigDecimal;
import java.time.LocalDateTime;

/**
 * QUESTÃO 1A DO AT - Agregado Pedido
 * Agregado NÃO-ANÊMICO com métodos de negócio
 * Implementa transições de estado conforme diagrama do Assessment
 */
@Aggregate
@Entity
public class Pedido {

    @AggregateIdentifier
    @Id
    private String id;

    private String clienteId;
    private BigDecimal valorTotal;
    private LocalDateTime dataCriacao;
    private LocalDateTime dataFechamento;
    private String status;

    // Construtor padrão obrigatório
    public Pedido() {
    }

    // =================================================================
    // COMANDO: CRIAR PEDIDO (NOVO)
    // =================================================================

    @CommandHandler
    public Pedido(CriarPedidoCommand command) {
        // Validações de negócio
        if (command.valorTotal == null || command.valorTotal.compareTo(BigDecimal.ZERO) <= 0) {
            throw new IllegalArgumentException("Valor do pedido deve ser positivo");
        }
        if (command.clienteId == null || command.clienteId.isBlank()) {
            throw new IllegalArgumentException("Cliente é obrigatório");
        }

        // Aplica evento (NÃO altera estado aqui!)
        AggregateLifecycle.apply(new PedidoCriadoEvent(
                command.id,
                command.clienteId,
                command.valorTotal,
                LocalDateTime.now(),
                StatusPedido.NOVO.name()
        ));
    }

    @EventSourcingHandler
    protected void on(PedidoCriadoEvent evento) {
        // ÚNICO local que altera estado
        this.id = evento.id;
        this.clienteId = evento.clienteId;
        this.valorTotal = evento.valorTotal;
        this.dataCriacao = evento.dataCriacao;
        this.status = evento.status;
    }

    // =================================================================
    // COMANDO: FECHAR PEDIDO (NOVO -> FECHADO)
    // =================================================================

    @CommandHandler
    public void handle(FecharPedidoCommand command) {
        // Validação de regra de negócio
        if (!this.status.equals(StatusPedido.NOVO.name())) {
            throw new IllegalStateException(
                    "Apenas pedidos novos podem ser fechados. Status atual: " + this.status
            );
        }

        // Aplica evento
        AggregateLifecycle.apply(new PedidoFechadoEvent(
                this.id,
                LocalDateTime.now()
        ));
    }

    @EventSourcingHandler
    protected void on(PedidoFechadoEvent evento) {
        this.status = StatusPedido.FECHADO.name();
        this.dataFechamento = evento.dataFechamento;
    }

    // =================================================================
    // COMANDO: ENVIAR PEDIDO (FECHADO -> EM_PREPARACAO)
    // =================================================================

    @CommandHandler
    public void handle(EnviarPedidoCommand command) {
        // Validação de regra de negócio
        if (!this.status.equals(StatusPedido.FECHADO.name())) {
            throw new IllegalStateException(
                    "Apenas pedidos fechados podem ser enviados. Status atual: " + this.status
            );
        }

        // Aplica evento
        AggregateLifecycle.apply(new PedidoEnviadoEvent(
                this.id,
                this.clienteId,
                LocalDateTime.now()
        ));
    }

    @EventSourcingHandler
    protected void on(PedidoEnviadoEvent evento) {
        this.status = StatusPedido.EM_PREPARACAO.name();
    }

    // =================================================================
    // COMANDO: CANCELAR PEDIDO
    // =================================================================

    @CommandHandler
    public void handle(CancelarPedidoCommand command) {
        // Validação de regra de negócio
        if (this.status.equals(StatusPedido.CANCELADO.name())) {
            throw new IllegalStateException("Pedido já está cancelado");
        }
        if (this.status.equals(StatusPedido.EM_TRANSITO.name()) ||
                this.status.equals(StatusPedido.ENTREGUE.name())) {
            throw new IllegalStateException(
                    "Não é possível cancelar pedido em trânsito ou entregue"
            );
        }

        // Aplica evento
        AggregateLifecycle.apply(new PedidoCanceladoEvent(
                this.id,
                command.motivo,
                LocalDateTime.now()
        ));
    }

    @EventSourcingHandler
    protected void on(PedidoCanceladoEvent evento) {
        this.status = StatusPedido.CANCELADO.name();
    }

    // =================================================================
    // GETTERS E SETTERS (necessários para JPA)
    // =================================================================

    public String getId() { return id; }
    public void setId(String id) { this.id = id; }

    public String getClienteId() { return clienteId; }
    public void setClienteId(String clienteId) { this.clienteId = clienteId; }

    public BigDecimal getValorTotal() { return valorTotal; }
    public void setValorTotal(BigDecimal valorTotal) { this.valorTotal = valorTotal; }

    public LocalDateTime getDataCriacao() { return dataCriacao; }
    public void setDataCriacao(LocalDateTime dataCriacao) { this.dataCriacao = dataCriacao; }

    public LocalDateTime getDataFechamento() { return dataFechamento; }
    public void setDataFechamento(LocalDateTime dataFechamento) { this.dataFechamento = dataFechamento; }

    public String getStatus() { return status; }
    public void setStatus(String status) { this.status = status; }
}

=== File: src/main/java/com/infnet/TP3_DR4_Luisa/domain/StatusPedido.java ===
package com.infnet.petfriends_pedidos.domain;

/**
 * Estados possíveis do Pedido conforme diagrama de estados
 * apresentado nas aulas 7 e 12.
 */
public enum StatusPedido {
    NOVO,
    FECHADO,
    EM_PREPARACAO,
    EM_TRANSITO,
    ENTREGUE,
    CANCELADO
}

=== File: src/main/java/com/infnet/TP3_DR4_Luisa/domain/vo/Endereco.java ===
package com.infnet.petfriends_pedidos.domain.vo;

import jakarta.persistence.Embeddable;
import java.util.Objects;

/**
 * QUESTÃO 2 DO AT - Value Object Endereco
 * Características:
 * - Imutável (sem setters)
 * - Sem identidade própria
 * - Validações no construtor
 * - Equals e HashCode baseados em valores
 */
@Embeddable
public class Endereco {

    private String rua;
    private String numero;
    private String complemento;
    private String bairro;
    private String cidade;
    private String estado;
    private String cep;

    // Construtor default (obrigatório para JPA)
    protected Endereco() {}

    // Construtor com validações (garante objeto sempre válido)
    public Endereco(String rua, String numero, String bairro,
                    String cidade, String estado, String cep) {
        // Validações
        if (rua == null || rua.isBlank()) {
            throw new IllegalArgumentException("Rua não pode ser vazia");
        }
        if (cidade == null || cidade.isBlank()) {
            throw new IllegalArgumentException("Cidade não pode ser vazia");
        }
        if (estado == null || estado.isBlank()) {
            throw new IllegalArgumentException("Estado não pode ser vazio");
        }
        if (cep == null || !cep.matches("\\d{5}-?\\d{3}")) {
            throw new IllegalArgumentException("CEP inválido. Use formato: 12345-678");
        }

        this.rua = rua;
        this.numero = numero;
        this.bairro = bairro;
        this.cidade = cidade;
        this.estado = estado;
        this.cep = cep;
    }

    // APENAS GETTERS (imutabilidade - não pode mudar depois de criado)
    public String getRua() { return rua; }
    public String getNumero() { return numero; }
    public String getComplemento() { return complemento; }
    public String getBairro() { return bairro; }
    public String getCidade() { return cidade; }
    public String getEstado() { return estado; }
    public String getCep() { return cep; }

    // Equals e HashCode baseados em TODOS os campos (value equality)
    @Override
    public boolean equals(Object o) {
        if (this == o) return true;
        if (!(o instanceof Endereco)) return false;
        Endereco endereco = (Endereco) o;
        return Objects.equals(rua, endereco.rua) &&
                Objects.equals(numero, endereco.numero) &&
                Objects.equals(cep, endereco.cep) &&
                Objects.equals(cidade, endereco.cidade) &&
                Objects.equals(estado, endereco.estado);
    }

    @Override
    public int hashCode() {
        return Objects.hash(rua, numero, cep, cidade, estado);
    }

    @Override
    public String toString() {
        return String.format("%s, %s - %s - %s/%s - CEP: %s",
                rua, numero, bairro, cidade, estado, cep);
    }
}

=== File: src/main/java/com/infnet/TP3_DR4_Luisa/domain/vo/ValorMonetario.java ===
package com.infnet.petfriends_pedidos.domain.vo;

import jakarta.persistence.Embeddable;
import java.math.BigDecimal;
import java.math.RoundingMode;
import java.util.Objects;

/**
 * QUESTÃO 2 DO AT - Value Object ValorMonetario
 * Encapsula BigDecimal com regras de negócio monetárias
 */
@Embeddable
public class ValorMonetario {

    private BigDecimal valor;

    // Construtor default (JPA)
    protected ValorMonetario() {}

    // Construtor privado (usar factory methods)
    private ValorMonetario(BigDecimal valor) {
        if (valor == null) {
            throw new IllegalArgumentException("Valor não pode ser nulo");
        }
        if (valor.compareTo(BigDecimal.ZERO) < 0) {
            throw new IllegalArgumentException("Valor não pode ser negativo");
        }
        // Sempre 2 casas decimais
        this.valor = valor.setScale(2, RoundingMode.HALF_UP);
    }

    // Factory methods
    public static ValorMonetario de(BigDecimal valor) {
        return new ValorMonetario(valor);
    }

    public static ValorMonetario de(double valor) {
        return new ValorMonetario(BigDecimal.valueOf(valor));
    }

    public static ValorMonetario zero() {
        return new ValorMonetario(BigDecimal.ZERO);
    }

    // Operações (sempre retornam novo objeto - imutabilidade)
    public ValorMonetario somar(ValorMonetario outro) {
        return new ValorMonetario(this.valor.add(outro.valor));
    }

    public ValorMonetario subtrair(ValorMonetario outro) {
        return new ValorMonetario(this.valor.subtract(outro.valor));
    }

    public boolean maiorQue(ValorMonetario outro) {
        return this.valor.compareTo(outro.valor) > 0;
    }

    public boolean menorQue(ValorMonetario outro) {
        return this.valor.compareTo(outro.valor) < 0;
    }

    // Getter
    public BigDecimal getValor() {
        return valor;
    }

    @Override
    public boolean equals(Object o) {
        if (this == o) return true;
        if (!(o instanceof ValorMonetario)) return false;
        ValorMonetario that = (ValorMonetario) o;
        return Objects.equals(valor, that.valor);
    }

    @Override
    public int hashCode() {
        return Objects.hash(valor);
    }

    @Override
    public String toString() {
        return "R$ " + valor.toString();
    }
}

=== File: src/main/java/com/infnet/TP3_DR4_Luisa/events/BaseEvent.java ===
package com.infnet.petfriends_pedidos.events;

/**
 * Classe base para todos os eventos de domínio que serão
 * persistidos no Event Store do Axon Framework.
 * Contém o identificador do agregado ao qual o evento pertence.
 */
public class BaseEvent<T> {

    public final T id;

    public BaseEvent(T id) {
        this.id = id;
    }
}

=== File: src/main/java/com/infnet/TP3_DR4_Luisa/events/PedidoCanceladoEvent.java ===
package com.infnet.petfriends_pedidos.events;

import java.time.LocalDateTime;

/**
 * Evento disparado quando pedido é cancelado.
 */
public class PedidoCanceladoEvent extends BaseEvent<String> {

    public final String motivo;
    public final LocalDateTime dataCancelamento;

    public PedidoCanceladoEvent(String id, String motivo, LocalDateTime dataCancelamento) {
        super(id);
        this.motivo = motivo;
        this.dataCancelamento = dataCancelamento;
    }
}

=== File: src/main/java/com/infnet/TP3_DR4_Luisa/events/PedidoCriadoEvent.java ===
package com.infnet.petfriends_pedidos.events;

import java.math.BigDecimal;
import java.time.LocalDateTime;

/**
 * Evento disparado quando um novo pedido é criado no sistema.
 * Representa algo que JÁ ACONTECEU (verbo no passado).
 * Contém os dados essenciais do pedido criado.
 */
public class PedidoCriadoEvent extends BaseEvent<String> {

    public final String clienteId;
    public final BigDecimal valorTotal;
    public final LocalDateTime dataCriacao;
    public final String status;

    public PedidoCriadoEvent(String id, String clienteId,
                             BigDecimal valorTotal,
                             LocalDateTime dataCriacao,
                             String status) {
        super(id);
        this.clienteId = clienteId;
        this.valorTotal = valorTotal;
        this.dataCriacao = dataCriacao;
        this.status = status;
    }
}

=== File: src/main/java/com/infnet/TP3_DR4_Luisa/events/PedidoEnviadoEvent.java ===
package com.infnet.petfriends_pedidos.events;

import java.time.LocalDateTime;

/**
 * Evento disparado quando pedido é enviado para preparação.
 * Este evento será consumido pelo microsserviço Almoxarifado.
 */
public class PedidoEnviadoEvent extends BaseEvent<String> {

    public final LocalDateTime dataEnvio;
    public final String clienteId;

    public PedidoEnviadoEvent(String id, String clienteId, LocalDateTime dataEnvio) {
        super(id);
        this.clienteId = clienteId;
        this.dataEnvio = dataEnvio;
    }
}

=== File: src/main/java/com/infnet/TP3_DR4_Luisa/events/PedidoFechadoEvent.java ===
package com.infnet.petfriends_pedidos.events;

import java.time.LocalDateTime;

/**
 * Evento disparado quando pedido é fechado (pagamento confirmado).
 */
public class PedidoFechadoEvent extends BaseEvent<String> {

    public final LocalDateTime dataFechamento;

    public PedidoFechadoEvent(String id, LocalDateTime dataFechamento) {
        super(id);
        this.dataFechamento = dataFechamento;
    }
}

=== File: src/main/java/com/infnet/TP3_DR4_Luisa/infra/PedidoRepository.java ===
package com.infnet.petfriends_pedidos.infra;

import com.infnet.petfriends_pedidos.domain.Pedido;
import org.springframework.data.jpa.repository.JpaRepository;

/**
 * Repository JPA para persistência do Read Model (estado atual).
 * Separado do Event Store - princípio do CQRS.
 */
public interface PedidoRepository extends JpaRepository<Pedido, String> {
}

=== File: src/main/java/com/infnet/TP3_DR4_Luisa/services/PedidoCommandService.java ===
package com.infnet.petfriends_pedidos.services;

import com.infnet.petfriends_pedidos.domain.Pedido;
import java.util.concurrent.CompletableFuture;

/**
 * Interface do serviço de comandos.
 * Define operações que modificam o estado do agregado Pedido.
 */
import com.infnet.petfriends_pedidos.domain.Pedido;
import java.util.concurrent.CompletableFuture;

public interface PedidoCommandService {
    CompletableFuture<String> criarPedido(Pedido pedido);
    CompletableFuture<Void> fecharPedido(String id);
    CompletableFuture<Void> enviarPedido(String id);
    CompletableFuture<Void> cancelarPedido(String id, String motivo);
}

=== File: src/main/java/com/infnet/TP3_DR4_Luisa/services/PedidoCommandServiceImpl.java ===
package com.infnet.petfriends_pedidos.services;

import com.infnet.petfriends_pedidos.commands.*;
import com.infnet.petfriends_pedidos.domain.Pedido;
import org.axonframework.commandhandling.gateway.CommandGateway;
import org.springframework.stereotype.Service;

import java.util.UUID;
import java.util.concurrent.CompletableFuture;

@Service
public class PedidoCommandServiceImpl implements PedidoCommandService {

    private final CommandGateway commandGateway;

    public PedidoCommandServiceImpl(CommandGateway commandGateway) {
        this.commandGateway = commandGateway;
    }

    @Override
    public CompletableFuture<String> criarPedido(Pedido pedido) {
        return commandGateway.send(new CriarPedidoCommand(
                UUID.randomUUID().toString(),
                pedido.getClienteId(),
                pedido.getValorTotal()
        ));
    }

    @Override
    public CompletableFuture<Void> fecharPedido(String id) {
        return commandGateway.send(new FecharPedidoCommand(id));
    }

    @Override
    public CompletableFuture<Void> enviarPedido(String id) {
        return commandGateway.send(new EnviarPedidoCommand(id));
    }

    @Override
    public CompletableFuture<Void> cancelarPedido(String id, String motivo) {
        return commandGateway.send(new CancelarPedidoCommand(id, motivo));
    }
}

=== File: src/main/java/com/infnet/TP3_DR4_Luisa/services/PedidoQueryService.java ===
package com.infnet.petfriends_pedidos.services;

import com.infnet.petfriends_pedidos.domain.Pedido;
import java.util.List;
import java.util.Optional;

public interface PedidoQueryService {
    List<Object> listarEventos(String id);
    Optional<Pedido> obterPorId(String id);
}

=== File: src/main/java/com/infnet/TP3_DR4_Luisa/services/PedidoQueryServiceImpl.java ===
package com.infnet.petfriends_pedidos.services;

import com.infnet.petfriends_pedidos.domain.Pedido;
import com.infnet.petfriends_pedidos.infra.PedidoRepository;
import org.axonframework.eventsourcing.eventstore.EventStore;
import org.springframework.stereotype.Service;

import java.util.List;
import java.util.Optional;
import java.util.stream.Collectors;

@Service
public class PedidoQueryServiceImpl implements PedidoQueryService {

    private final EventStore eventStore;
    private final PedidoRepository pedidoRepository;

    public PedidoQueryServiceImpl(EventStore eventStore,
                                  PedidoRepository pedidoRepository) {
        this.eventStore = eventStore;
        this.pedidoRepository = pedidoRepository;
    }

    /**
     * QUESTÃO 8: Lista TODOS os eventos do agregado específico.
     */
    @Override
    public List<Object> listarEventos(String id) {
        return eventStore.readEvents(id, 0)
                .asStream()
                .map(record -> record.getPayload())
                .collect(Collectors.toList());
    }

    /**
     * QUESTÃO 10: Obtém o estado atual do agregado por ID.
     */
    @Override
    public Optional<Pedido> obterPorId(String id) {
        return pedidoRepository.findById(id);
    }
}

=== File: src/main/java/com/infnet/TP3_DR4_Luisa/Tp3Dr4LuisaApplication.java ===
package com.infnet.petfriends_pedidos;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class Tp3Dr4LuisaApplication {

	public static void main(String[] args) {
		SpringApplication.run(Tp3Dr4LuisaApplication.class, args);
	}

}


=== File: src/main/resources/application.properties ===
spring.application.name=TP3_DR4_Luisa

# ============================================
# H2 Database Configuration
# ============================================
spring.datasource.url=jdbc:h2:file:./data/tp3_pedidos
spring.datasource.username=sa
spring.datasource.password=password
spring.datasource.driver-class-name=org.h2.Driver

# H2 Console (acesse em: http://localhost:8080/h2-console)
spring.h2.console.enabled=true
spring.h2.console.path=/h2-console

# ============================================
# JPA/Hibernate Configuration
# ============================================
spring.jpa.database-platform=org.hibernate.dialect.H2Dialect
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.format_sql=true

# ============================================
# Swagger/OpenAPI Configuration
# (acesse em: http://localhost:8080/swagger-ui.html)
# ============================================
springdoc.api-docs.path=/api-docs
springdoc.swagger-ui.path=/swagger-ui.html
springdoc.swagger-ui.enabled=true

=== File: src/test/java/com/infnet/TP3_DR4_Luisa/Tp3Dr4LuisaApplicationTests.java ===
package com.infnet.petfriends_pedidos;

import org.junit.jupiter.api.Test;
import org.springframework.boot.test.context.SpringBootTest;

@SpringBootTest
class Tp3Dr4LuisaApplicationTests {

	@Test
	void contextLoads() {
	}

}


=== File: tp3_dr4.txt ===
=== File: .idea/compiler.xml ===
<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CompilerConfiguration">
    <annotationProcessing>
      <profile name="Maven default annotation processors profile" enabled="true">
        <sourceOutputDir name="target/generated-sources/annotations" />
        <sourceTestOutputDir name="target/generated-test-sources/test-annotations" />
        <outputRelativeToContentRoot value="true" />
        <module name="TP3_DR4_Luisa" />
      </profile>
    </annotationProcessing>
  </component>
  <component name="JavacSettings">
    <option name="ADDITIONAL_OPTIONS_OVERRIDE">
      <module name="TP3_DR4_Luisa" options="-parameters" />
    </option>
  </component>
</project>

=== File: .idea/encodings.xml ===
<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="Encoding">
    <file url="file://$PROJECT_DIR$/src/main/java" charset="UTF-8" />
  </component>
</project>

=== File: .idea/jarRepositories.xml ===
<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="RemoteRepositoriesConfiguration">
    <remote-repository>
      <option name="id" value="central" />
      <option name="name" value="Central Repository" />
      <option name="url" value="https://repo.maven.apache.org/maven2" />
    </remote-repository>
    <remote-repository>
      <option name="id" value="central" />
      <option name="name" value="Maven Central repository" />
      <option name="url" value="https://repo1.maven.org/maven2" />
    </remote-repository>
    <remote-repository>
      <option name="id" value="jboss.community" />
      <option name="name" value="JBoss Community repository" />
      <option name="url" value="https://repository.jboss.org/nexus/content/repositories/public/" />
    </remote-repository>
  </component>
</project>

=== File: .idea/misc.xml ===
<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="ExternalStorageConfigurationManager" enabled="true" />
  <component name="MavenProjectsManager">
    <option name="originalFiles">
      <list>
        <option value="$PROJECT_DIR$/pom.xml" />
      </list>
    </option>
  </component>
  <component name="ProjectRootManager" version="2" languageLevel="JDK_21" default="true" project-jdk-name="21" project-jdk-type="JavaSDK" />
</project>

=== File: .idea/workspace.xml ===
<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="AutoImportSettings">
    <option name="autoReloadType" value="SELECTIVE" />
  </component>
  <component name="ChangeListManager">
    <list default="true" id="375b244d-086e-4d4f-ad7e-505687fff5ee" name="Changes" comment="" />
    <option name="SHOW_DIALOG" value="false" />
    <option name="HIGHLIGHT_CONFLICTS" value="true" />
    <option name="HIGHLIGHT_NON_ACTIVE_CHANGELIST" value="false" />
    <option name="LAST_RESOLUTION" value="IGNORE" />
  </component>
  <component name="FileTemplateManagerImpl">
    <option name="RECENT_TEMPLATES">
      <list>
        <option value="Class" />
      </list>
    </option>
  </component>
  <component name="MavenImportPreferences">
    <option name="generalSettings">
      <MavenGeneralSettings>
        <option name="mavenHomeTypeForPersistence" value="WRAPPER" />
      </MavenGeneralSettings>
    </option>
  </component>
  <component name="ProblemsViewState">
    <option name="selectedTabId" value="DEPENDENCY_CHECKER_PROBLEMS_TAB" />
  </component>
  <component name="ProjectColorInfo">{
  &quot;associatedIndex&quot;: 1
}</component>
  <component name="ProjectId" id="35lzw9jwj0Eub9hnnovLqGsCc1x" />
  <component name="ProjectViewState">
    <option name="hideEmptyMiddlePackages" value="true" />
    <option name="showLibraryContents" value="true" />
  </component>
  <component name="PropertiesComponent">{
  &quot;keyToString&quot;: {
    &quot;ModuleVcsDetector.initialDetectionPerformed&quot;: &quot;true&quot;,
    &quot;RequestMappingsPanelOrder0&quot;: &quot;0&quot;,
    &quot;RequestMappingsPanelOrder1&quot;: &quot;1&quot;,
    &quot;RequestMappingsPanelWidth0&quot;: &quot;75&quot;,
    &quot;RequestMappingsPanelWidth1&quot;: &quot;75&quot;,
    &quot;RunOnceActivity.ShowReadmeOnStart&quot;: &quot;true&quot;,
    &quot;Spring Boot.Tp3Dr4LuisaApplication.executor&quot;: &quot;Run&quot;,
    &quot;last_opened_file_path&quot;: &quot;C:/Users/Luisa/Downloads/TP3_DR4_Luisa/TP3_DR4_Luisa&quot;,
    &quot;node.js.detected.package.eslint&quot;: &quot;true&quot;,
    &quot;node.js.detected.package.tslint&quot;: &quot;true&quot;,
    &quot;node.js.selected.package.eslint&quot;: &quot;(autodetect)&quot;,
    &quot;node.js.selected.package.tslint&quot;: &quot;(autodetect)&quot;,
    &quot;nodejs_package_manager_path&quot;: &quot;npm&quot;,
    &quot;vue.rearranger.settings.migration&quot;: &quot;true&quot;
  }
}</component>
  <component name="RunManager">
    <configuration name="Tp3Dr4LuisaApplication" type="SpringBootApplicationConfigurationType" factoryName="Spring Boot" nameIsGenerated="true">
      <module name="TP3_DR4_Luisa" />
      <option name="SPRING_BOOT_MAIN_CLASS" value="com.infnet.petfriends_pedidos.PetfriendsPedidosApplication" />
      <method v="2">
        <option name="Make" enabled="true" />
      </method>
    </configuration>
  </component>
  <component name="SharedIndexes">
    <attachedChunks>
      <set>
        <option value="bundled-jdk-9823dce3aa75-fbdcb00ec9e3-intellij.indexing.shared.core-IU-251.26927.53" />
        <option value="bundled-js-predefined-d6986cc7102b-09060db00ec0-JavaScript-IU-251.26927.53" />
      </set>
    </attachedChunks>
  </component>
  <component name="TaskManager">
    <task active="true" id="Default" summary="Default task">
      <changelist id="375b244d-086e-4d4f-ad7e-505687fff5ee" name="Changes" comment="" />
      <created>1763699681702</created>
      <option name="number" value="Default" />
      <option name="presentableId" value="Default" />
      <updated>1763699681702</updated>
      <workItem from="1763699682810" duration="286000" />
      <workItem from="1763699979030" duration="1313000" />
      <workItem from="1763879425125" duration="6279000" />
      <workItem from="1764002791244" duration="226000" />
    </task>
    <servers />
  </component>
  <component name="TypeScriptGeneratedFilesManager">
    <option name="version" value="3" />
  </component>
</project>

=== File: .mvn/wrapper/maven-wrapper.properties ===
wrapperVersion=3.3.4
distributionType=only-script
distributionUrl=https://repo.maven.apache.org/maven2/org/apache/maven/apache-maven/3.9.11/apache-maven-3.9.11-bin.zip


=== File: HELP.md ===
# Getting Started

### Reference Documentation
For further reference, please consider the following sections:

* [Official Apache Maven documentation](https://maven.apache.org/guides/index.html)
* [Spring Boot Maven Plugin Reference Guide](https://docs.spring.io/spring-boot/3.5.8/maven-plugin)
* [Create an OCI image](https://docs.spring.io/spring-boot/3.5.8/maven-plugin/build-image.html)
* [Spring Web](https://docs.spring.io/spring-boot/3.5.8/reference/web/servlet.html)
* [Spring Data JPA](https://docs.spring.io/spring-boot/3.5.8/reference/data/sql.html#data.sql.jpa-and-spring-data)
* [Spring Boot Actuator](https://docs.spring.io/spring-boot/3.5.8/reference/actuator/index.html)
* [Validation](https://docs.spring.io/spring-boot/3.5.8/reference/io/validation.html)

### Guides
The following guides illustrate how to use some features concretely:

* [Building a RESTful Web Service](https://spring.io/guides/gs/rest-service/)
* [Serving Web Content with Spring MVC](https://spring.io/guides/gs/serving-web-content/)
* [Building REST services with Spring](https://spring.io/guides/tutorials/rest/)
* [Accessing Data with JPA](https://spring.io/guides/gs/accessing-data-jpa/)
* [Building a RESTful Web Service with Spring Boot Actuator](https://spring.io/guides/gs/actuator-service/)
* [Validation](https://spring.io/guides/gs/validating-form-input/)

### Maven Parent overrides

Due to Maven's design, elements are inherited from the parent POM to the project POM.
While most of the inheritance is fine, it also inherits unwanted elements like `<license>` and `<developers>` from the parent.
To prevent this, the project POM contains empty overrides for these elements.
If you manually switch to a different parent and actually want the inheritance, you need to remove those overrides.



=== File: pom.xml ===
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">
	<modelVersion>4.0.0</modelVersion>
	<parent>
		<groupId>org.springframework.boot</groupId>
		<artifactId>spring-boot-starter-parent</artifactId>
		<version>3.5.8</version>
		<relativePath/> <!-- lookup parent from repository -->
	</parent>
	<groupId>com.infnet</groupId>
	<artifactId>TP3_DR4_Luisa</artifactId>
	<version>0.0.1-SNAPSHOT</version>
	<name>TP3_DR4_Luisa</name>
	<description>Demo project for Spring Boot</description>
	<url/>
	<licenses>
		<license/>
	</licenses>
	<developers>
		<developer/>
	</developers>
	<scm>
		<connection/>
		<developerConnection/>
		<tag/>
		<url/>
	</scm>
	<properties>
		<java.version>21</java.version>
	</properties>
	<dependencies>
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-actuator</artifactId>
		</dependency>
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-data-jpa</artifactId>
		</dependency>
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-validation</artifactId>
		</dependency>
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-web</artifactId>
		</dependency>

		<dependency>
			<groupId>com.h2database</groupId>
			<artifactId>h2</artifactId>
			<scope>runtime</scope>
		</dependency>
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-test</artifactId>
			<scope>test</scope>
		</dependency>
		<dependency>
			<groupId>org.axonframework</groupId>
			<artifactId>axon-spring-boot-starter</artifactId>
			<version>4.10.0</version>
			<exclusions>
				<exclusion>
					<groupId>org.axonframework</groupId>
					<artifactId>axon-server-connector</artifactId>
				</exclusion>
			</exclusions>
		</dependency>
		<dependency>
			<groupId>org.springdoc</groupId>
			<artifactId>springdoc-openapi-starter-webmvc-ui</artifactId>
			<version>2.6.0</version>
		</dependency>
	</dependencies>

	<build>
		<plugins>
			<plugin>
				<groupId>org.springframework.boot</groupId>
				<artifactId>spring-boot-maven-plugin</artifactId>
			</plugin>
		</plugins>
	</build>

</project>


=== File: src/main/java/com/infnet/TP3_DR4_Luisa/commands/BaseCommand.java ===
package com.infnet.petfriends_pedidos.commands;

import org.axonframework.modelling.command.TargetAggregateIdentifier;

/**
 * Classe base para todos os comandos que serão processados
 * pelo Axon Framework e provocarão a persistência de eventos.
 * A anotação @TargetAggregateIdentifier indica qual agregado
 * será alvo do comando.
 */
public class BaseCommand<T> {

    @TargetAggregateIdentifier
    public final T id;

    public BaseCommand(T id) {
        this.id = id;
    }
}

=== File: src/main/java/com/infnet/TP3_DR4_Luisa/commands/CriarPedidoCommand.java ===
package com.infnet.petfriends_pedidos.commands;

import java.math.BigDecimal;

/**
 * Comando para criar um novo pedido.
 * Representa a INTENÇÃO de criar (verbo imperativo).
 * Será processado pelo CommandHandler no agregado.
 */
public class CriarPedidoCommand extends BaseCommand<String> {

    public final String clienteId;
    public final BigDecimal valorTotal;

    public CriarPedidoCommand(String id, String clienteId,
                              BigDecimal valorTotal) {
        super(id);
        this.clienteId = clienteId;
        this.valorTotal = valorTotal;
    }
}

=== File: src/main/java/com/infnet/TP3_DR4_Luisa/controllers/PedidoCommandController.java ===
package com.infnet.petfriends_pedidos.controllers;

import com.infnet.petfriends_pedidos.domain.Pedido;
import com.infnet.petfriends_pedidos.services.PedidoCommandService;
import io.swagger.v3.oas.annotations.Operation;
import io.swagger.v3.oas.annotations.tags.Tag;
import org.springframework.web.bind.annotation.*;

import java.util.concurrent.CompletableFuture;

@RestController
@RequestMapping(value = "/pedidos")
@Tag(name = "Pedidos - Comandos", description = "Operações de escrita (Commands)")
public class PedidoCommandController {

    private final PedidoCommandService service;

    public PedidoCommandController(PedidoCommandService service) {
        this.service = service;
    }

    @PostMapping
    @Operation(summary = "Criar novo pedido")
    public CompletableFuture<String> criarPedido(@RequestBody Pedido pedido) {
        return service.criarPedido(pedido);
    }
}

=== File: src/main/java/com/infnet/TP3_DR4_Luisa/controllers/PedidoQueryController.java ===
package com.infnet.petfriends_pedidos.controllers;

import com.infnet.petfriends_pedidos.domain.Pedido;
import com.infnet.petfriends_pedidos.services.PedidoQueryService;
import io.swagger.v3.oas.annotations.Operation;
import io.swagger.v3.oas.annotations.tags.Tag;
import org.springframework.web.bind.annotation.*;

import java.util.List;

@RestController
@RequestMapping(value = "/pedidos")
@Tag(name = "Pedidos - Queries", description = "Operações de leitura (Queries)")
public class PedidoQueryController {

    private final PedidoQueryService service;

    public PedidoQueryController(PedidoQueryService service) {
        this.service = service;
    }

    @GetMapping("/{id}/eventos")
    @Operation(summary = "Listar eventos do pedido")
    public List<Object> listarEventos(@PathVariable(value = "id") String id) {
        return service.listarEventos(id);
    }

    @GetMapping("/{id}")
    @Operation(summary = "Obter pedido por ID")
    public Pedido obterPorId(@PathVariable(value = "id") String id) {
        return service.obterPorId(id).orElse(null);
    }
}

=== File: src/main/java/com/infnet/TP3_DR4_Luisa/domain/Pedido.java ===
package com.infnet.petfriends_pedidos.domain;

import com.infnet.petfriends_pedidos.commands.CriarPedidoCommand;
import com.infnet.petfriends_pedidos.events.PedidoCriadoEvent;
import jakarta.persistence.Entity;
import jakarta.persistence.Id;
import org.axonframework.commandhandling.CommandHandler;
import org.axonframework.eventsourcing.EventSourcingHandler;
import org.axonframework.modelling.command.AggregateIdentifier;
import org.axonframework.modelling.command.AggregateLifecycle;
import org.axonframework.spring.stereotype.Aggregate;

import java.math.BigDecimal;
import java.time.LocalDateTime;

/**
 * Agregado Pedido - Unidade atômica de modificação.
 * Contém CommandHandlers que recebem comandos e aplicam eventos.
 * Anotado com @Aggregate (Axon) e @Entity (JPA).
 */
@Aggregate
@Entity
public class Pedido {

    @AggregateIdentifier
    @Id
    private String id;

    private String clienteId;
    private BigDecimal valorTotal;
    private LocalDateTime dataCriacao;
    private String status;

    // Construtor padrão obrigatório para frameworks
    public Pedido() {
    }

    /**
     * QUESTÃO 6: CommandHandler - Recebe comando e toma decisões de negócio.
     * NÃO altera estado diretamente - apenas aplica eventos.
     */
    @CommandHandler
    public Pedido(CriarPedidoCommand command) {
        // Validações de negócio
        if (command.valorTotal == null || command.valorTotal.compareTo(BigDecimal.ZERO) <= 0) {
            throw new IllegalArgumentException("Valor do pedido deve ser positivo");
        }

        // Aplica evento - Estado será alterado pelo EventSourcingHandler
        AggregateLifecycle.apply(new PedidoCriadoEvent(
                command.id,
                command.clienteId,
                command.valorTotal,
                LocalDateTime.now(),
                StatusPedido.NOVO.name()
        ));
    }

    /**
     * QUESTÃO 7: EventSourcingHandler - Único local que ALTERA o estado do agregado.
     * Invocado:
     * 1. Imediatamente após CommandHandler aplicar evento
     * 2. Durante recarga do agregado (replay de eventos)
     */
    @EventSourcingHandler
    protected void on(PedidoCriadoEvent evento) {
        this.id = evento.id;
        this.clienteId = evento.clienteId;
        this.valorTotal = evento.valorTotal;
        this.dataCriacao = evento.dataCriacao;
        this.status = evento.status;
    }

    // Getters
    public String getId() { return id; }
    public String getClienteId() { return clienteId; }
    public BigDecimal getValorTotal() { return valorTotal; }
    public LocalDateTime getDataCriacao() { return dataCriacao; }
    public String getStatus() { return status; }

    // Setters (necessários para JPA)
    public void setId(String id) { this.id = id; }
    public void setClienteId(String clienteId) { this.clienteId = clienteId; }
    public void setValorTotal(BigDecimal valorTotal) { this.valorTotal = valorTotal; }
    public void setDataCriacao(LocalDateTime dataCriacao) { this.dataCriacao = dataCriacao; }
    public void setStatus(String status) { this.status = status; }
}

=== File: src/main/java/com/infnet/TP3_DR4_Luisa/domain/StatusPedido.java ===
package com.infnet.petfriends_pedidos.domain;

/**
 * Estados possíveis do Pedido conforme diagrama de estados
 * apresentado nas aulas 7 e 12.
 */
public enum StatusPedido {
    NOVO,
    FECHADO,
    EM_PREPARACAO,
    EM_TRANSITO,
    ENTREGUE,
    CANCELADO
}

=== File: src/main/java/com/infnet/TP3_DR4_Luisa/events/BaseEvent.java ===
package com.infnet.petfriends_pedidos.events;

/**
 * Classe base para todos os eventos de domínio que serão
 * persistidos no Event Store do Axon Framework.
 * Contém o identificador do agregado ao qual o evento pertence.
 */
public class BaseEvent<T> {

    public final T id;

    public BaseEvent(T id) {
        this.id = id;
    }
}

=== File: src/main/java/com/infnet/TP3_DR4_Luisa/events/PedidoCriadoEvent.java ===
package com.infnet.petfriends_pedidos.events;

import java.math.BigDecimal;
import java.time.LocalDateTime;

/**
 * Evento disparado quando um novo pedido é criado no sistema.
 * Representa algo que JÁ ACONTECEU (verbo no passado).
 * Contém os dados essenciais do pedido criado.
 */
public class PedidoCriadoEvent extends BaseEvent<String> {

    public final String clienteId;
    public final BigDecimal valorTotal;
    public final LocalDateTime dataCriacao;
    public final String status;

    public PedidoCriadoEvent(String id, String clienteId,
                             BigDecimal valorTotal,
                             LocalDateTime dataCriacao,
                             String status) {
        super(id);
        this.clienteId = clienteId;
        this.valorTotal = valorTotal;
        this.dataCriacao = dataCriacao;
        this.status = status;
    }
}

=== File: src/main/java/com/infnet/TP3_DR4_Luisa/infra/PedidoRepository.java ===
package com.infnet.petfriends_pedidos.infra;

import com.infnet.petfriends_pedidos.domain.Pedido;
import org.springframework.data.jpa.repository.JpaRepository;

/**
 * Repository JPA para persistência do Read Model (estado atual).
 * Separado do Event Store - princípio do CQRS.
 */
public interface PedidoRepository extends JpaRepository<Pedido, String> {
}

=== File: src/main/java/com/infnet/TP3_DR4_Luisa/services/PedidoCommandService.java ===
package com.infnet.petfriends_pedidos.services;

import com.infnet.petfriends_pedidos.domain.Pedido;
import java.util.concurrent.CompletableFuture;

/**
 * Interface do serviço de comandos.
 * Define operações que modificam o estado do agregado Pedido.
 */
public interface PedidoCommandService {
    CompletableFuture<String> criarPedido(Pedido pedido);
}

=== File: src/main/java/com/infnet/TP3_DR4_Luisa/services/PedidoCommandServiceImpl.java ===
package com.infnet.petfriends_pedidos.services;

import com.infnet.petfriends_pedidos.commands.CriarPedidoCommand;
import com.infnet.petfriends_pedidos.domain.Pedido;
import org.axonframework.commandhandling.gateway.CommandGateway;
import org.springframework.stereotype.Service;

import java.util.UUID;
import java.util.concurrent.CompletableFuture;

/**
 * Implementação do serviço de comandos.
 * Utiliza o CommandGateway do Axon para despachar comandos.
 * O CommandGateway é responsável pelo roteamento - baixo acoplamento.
 */
@Service
public class PedidoCommandServiceImpl implements PedidoCommandService {

    private final CommandGateway commandGateway;

    public PedidoCommandServiceImpl(CommandGateway commandGateway) {
        this.commandGateway = commandGateway;
    }

    @Override
    public CompletableFuture<String> criarPedido(Pedido pedido) {
        return commandGateway.send(new CriarPedidoCommand(
                UUID.randomUUID().toString(),
                pedido.getClienteId(),
                pedido.getValorTotal()
        ));
    }
}

=== File: src/main/java/com/infnet/TP3_DR4_Luisa/services/PedidoQueryService.java ===
package com.infnet.petfriends_pedidos.services;

import com.infnet.petfriends_pedidos.domain.Pedido;
import java.util.List;
import java.util.Optional;

public interface PedidoQueryService {
    List<Object> listarEventos(String id);
    Optional<Pedido> obterPorId(String id);
}

=== File: src/main/java/com/infnet/TP3_DR4_Luisa/services/PedidoQueryServiceImpl.java ===
package com.infnet.petfriends_pedidos.services;

import com.infnet.petfriends_pedidos.domain.Pedido;
import com.infnet.petfriends_pedidos.infra.PedidoRepository;
import org.axonframework.eventsourcing.eventstore.EventStore;
import org.springframework.stereotype.Service;

import java.util.List;
import java.util.Optional;
import java.util.stream.Collectors;

@Service
public class PedidoQueryServiceImpl implements PedidoQueryService {

    private final EventStore eventStore;
    private final PedidoRepository pedidoRepository;

    public PedidoQueryServiceImpl(EventStore eventStore,
                                  PedidoRepository pedidoRepository) {
        this.eventStore = eventStore;
        this.pedidoRepository = pedidoRepository;
    }

    /**
     * QUESTÃO 8: Lista TODOS os eventos do agregado específico.
     */
    @Override
    public List<Object> listarEventos(String id) {
        return eventStore.readEvents(id, 0)
                .asStream()
                .map(record -> record.getPayload())
                .collect(Collectors.toList());
    }

    /**
     * QUESTÃO 10: Obtém o estado atual do agregado por ID.
     */
    @Override
    public Optional<Pedido> obterPorId(String id) {
        return pedidoRepository.findById(id);
    }
}

=== File: src/main/java/com/infnet/TP3_DR4_Luisa/Tp3Dr4LuisaApplication.java ===
package com.infnet.petfriends_pedidos;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class Tp3Dr4LuisaApplication {

	public static void main(String[] args) {
		SpringApplication.run(Tp3Dr4LuisaApplication.class, args);
	}

}


=== File: src/main/resources/application.properties ===
spring.application.name=TP3_DR4_Luisa

# ============================================
# H2 Database Configuration
# ============================================
spring.datasource.url=jdbc:h2:file:./data/tp3_pedidos
spring.datasource.username=sa
spring.datasource.password=password
spring.datasource.driver-class-name=org.h2.Driver

# H2 Console (acesse em: http://localhost:8080/h2-console)
spring.h2.console.enabled=true
spring.h2.console.path=/h2-console

# ============================================
# JPA/Hibernate Configuration
# ============================================
spring.jpa.database-platform=org.hibernate.dialect.H2Dialect
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.format_sql=true

# ============================================
# Swagger/OpenAPI Configuration
# (acesse em: http://localhost:8080/swagger-ui.html)
# ============================================
springdoc.api-docs.path=/api-docs
springdoc.swagger-ui.path=/swagger-ui.html
springdoc.swagger-ui.enabled=true

=== File: src/test/java/com/infnet/TP3_DR4_Luisa/Tp3Dr4LuisaApplicationTests.java ===
package com.infnet.petfriends_pedidos;

import org.junit.jupiter.api.Test;
import org.springframework.boot.test.context.SpringBootTest;

@SpringBootTest
class Tp3Dr4LuisaApplicationTests {

	@Test
	void contextLoads() {
	}

}




